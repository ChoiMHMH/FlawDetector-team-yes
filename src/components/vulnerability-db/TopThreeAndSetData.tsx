"use client";
import { useEffect, useMemo } from "react";
import TopThreeItem from "./TopThreeItem";
import { useVulnerabilityStore } from "@/store/useVulnerabilityStore";
import TopThreeLoading from "./TopThreeLoading";

function TopThreeAndSetData(): JSX.Element {
  const { data, setData, loaded, setLoaded } = useVulnerabilityStore();

  const fetchData = async () => {
    try {
      const response = await fetch("/api/vulnerabilities");
      const result = await response.json();
      setData(result);
      setLoaded(true);
    } catch (error) {
      console.error("Failed to fetch vulnerabilities", error);
    }
  };

  useEffect(() => {
    console.log("파이어베이스 로드 됐는지~:" + loaded);
    if (!loaded) {
      fetchData();
    }
  }, []);

  const topThreeItems = useMemo(() => {
    return <TopThreeItem />;
  }, [data]);

  return <>{data.length ? topThreeItems : <TopThreeLoading />}</>;
}

export default TopThreeAndSetData;
