import ChatBot from "@/components/chatBot/ChatBot";
import DetailContent from "@/components/vulnerability-detail/DetailContent";

import SimilarContent from "@/components/vulnerability-detail/SimilarContent";
import Table from "@/components/vulnerability-detail/Table";

import { Metadata } from "next";
import fetchDetailVulnerability from "@/firebase/fetchDetailVulnerability";
import { Params } from "@/types/common";
import { DetailData } from "@/types/vulnerability";
import { DocumentData } from "firebase/firestore";

export const metadata: Metadata = {
  title: "Vulerability DB Detail",
};

/**
 
@description 취약성 데이터베이스 상세 페이지 컴포넌트입니다. 페이지는 상세 내용, 테이블, 유사 콘텐츠를 포함합니다.*/
async function VulnerabilityDbDetailPage({ params }: Params) {
  // params.id로 요청
  const documentData: DocumentData | null = await fetchDetailVulnerability(
    params.id,
  );

  if (!documentData) {
    return <div>Data not found</div>;
  }
  // DocumentData를 DetailData 타입으로 변환
  const detailData: DetailData = {
    title: documentData.title ?? "", // 기본값 처리
    subtitle: documentData.subtitle ?? "",
    view: documentData.view ?? 0,
    content: documentData.content ?? "",
    arrayTable: documentData.arrayTable ?? [],
  };

  return (
    <>
      <div className="mx-auto mb-[60px] flex w-[65vw] flex-col gap-[30px] xl:w-[936px]">
        <DetailContent detailData={detailData} dataId={params.id} />
        <Table detailData={detailData} dataId={params.id} />
        <SimilarContent />
        <ChatBot />
      </div>
    </>
  );
}
export default VulnerabilityDbDetailPage;
