import ChatBot from "@/components/chatBot/ChatBot";

import MainContainer from "@/components/vulnerability-db/MainContainer";
import SearchBar from "@/components/vulnerability-db/SearchBar";
import TopThreeAndSetData from "@/components/vulnerability-db/TopThreeAndSetData";
import { Metadata } from "next";
import { getSession } from "@/lib/getSession";
import { SessionProvider } from "next-auth/react";
import { DetailData } from "@/types/vulnerability";
import fetchDetailVulnerability from "@/firebase/fetchDetailVulnerability";
import { DocumentData } from "firebase/firestore";
import { Params } from "@/types/common";
/**
 * @description 취약성 데이터베이스 페이지를 구성하는 컴포넌트입니다. 이 페이지는 상위 3개 항목, 기사 목록, 실시간 주제, 그리고 페이지네이션을 포함합니다.
 *
 * @returns {JSX.Element} 상위 3개 항목, 기사 목록, 실시간 주제 및 페이지네이션을 포함하는 페이지 컴포넌트를 반환합니다.
 */
export const metadata: Metadata = {
  title: "Vulerability DB ",
};
async function VulnerabilityDbPage({ params }: Params) {
  const session = await getSession();
  //챗봇때문에추가
  const documentData: DocumentData | null = await fetchDetailVulnerability(
    params.id,
  );
  //챗봇때문에추가
  if (!documentData) {
    return <div>Data not found</div>;
  }
  // DocumentData를 DetailData 타입으로 변환
  const detailData: DetailData = {
    title: documentData.title ?? "", // 기본값 처리
    subtitle: documentData.subtitle ?? "",
    view: documentData.view ?? 0,
    content: documentData.content ?? "",
    arrayTable: documentData.arrayTable ?? [],
  };
  return (
    <>
      <div className="mx-auto mb-[60px] flex w-[65vw] flex-col gap-[60px] xl:w-[936px]">
        <SessionProvider session={session}>
          <TopThreeAndSetData />
          {session && <SearchBar />}
          <MainContainer />
        </SessionProvider>
        <ChatBot detailData={detailData} dataId={params.id} />
      </div>
    </>
  );
}
export default VulnerabilityDbPage;
