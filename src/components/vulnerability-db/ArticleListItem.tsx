"use client";

import Image from "next/image";
import Chips from "./Chips";
import Link from "next/link";
import { ArticleDataList } from "./dummydata";
import pin from "/public/images/pin.png";
import pinActive from "/public/images/pin-active.png";
import share from "/public/images/share.png";
import { useState } from "react";

/**
 * @description 기사 목록 아이템을 표시하는 UI 컴포넌트입니다. 이 컴포넌트는 `ArticleDataList`의 데이터를 기반으로 각 기사의 제목, 레이블, 회사명, 짧은 설명, 그리고 액션 버튼을 표시합니다.
 *
 * @description 핀 상태와 공유 링크 기능을 지원합니다. 핀 버튼을 클릭하면 아이템의 핀 상태가 토글되고, 공유 버튼을 클릭하면 현재 링크를 복사하거나, 공유 기능을 통해 링크를 공유합니다.
 *
 * @returns {JSX.Element} 기사 목록 아이템을 표시하는 컴포넌트를 반환합니다. 각 아이템은 제목, 회사명, 짧은 설명과 함께 핀 및 공유 버튼을 포함합니다.
 */

type TPinState = {
  id: number;
  state: boolean;
};

function ArticleListItem(): JSX.Element {
  const [isPinned, setIsPinned] = useState<TPinState>({ id: 0, state: false });

  /**
   * @description 주어진 아이디에 대해 핀 상태를 토글합니다.
   *
   * @param {number} id - 핀 상태를 변경할 아이템의 ID입니다.
   */

  const handlePinState = (id: number) => {
    setIsPinned((prev) => ({ id: id, state: !prev.state }));
  };

  /**
   * @description 공유 버튼 클릭 시, 현재 페이지의 링크를 공유하거나 복사합니다.
   *
   * @param {number} id - 공유할 아이템의 ID입니다.
   */

  const handleShareLink = (id: number) => {
    const link = `${location.href}/${id}`;

    if (navigator.share) {
      navigator.share({ url: link });
    } else {
      navigator.clipboard.writeText(link);
      alert("링크가 복사되었습니다.");
    }
  };

  return (
    <>
      {ArticleDataList.map((item) => (
        <div
          key={item.id}
          className="flex h-[235px] flex-col gap-6 rounded-lg border border-neutral-20 p-7"
        >
          <div className="flex flex-col gap-2">
            <div className="flex items-center gap-[5px]">
              <Chips>{item.label}</Chips>
              <Link href={`/vulnerability-db/${item.id}`}>
                <h3 className="text-[15px]">{item.title}</h3>
              </Link>
            </div>
            <span className="text-[13px] text-neutral-30">{item.company}</span>
          </div>
          <div className="inline-block h-fit truncate rounded-xl bg-background-purpleLight px-3 py-2 text-center align-middle text-[13px] text-neutral-50 xl:py-3">
            {item.shortDesc}
          </div>
          <div className="flex justify-between">
            <div className="flex gap-3">
              <button onClick={() => handlePinState(item.id)}>
                {item.id === isPinned.id && isPinned.state ? (
                  <Image
                    src={pinActive}
                    alt="pin-active"
                    width={20}
                    height={20}
                  />
                ) : (
                  <Image src={pin} alt="pin" width={20} height={20} />
                )}
              </button>
              <button onClick={() => handleShareLink(item.id)}>
                <Image src={share} alt="share" width={20} height={20} />
              </button>
            </div>
            <span className="text-[13px] text-neutral-30">4일 전</span>
          </div>
        </div>
      ))}
    </>
  );
}

export default ArticleListItem;
